{% extends 'static/base.html' %}
{%  load static %}

{% block title %}

{{ movie.title }}

{% endblock %}

{% block head %}

    <!-- Home -->
    <link rel="stylesheet" href="{% static 'css/movie_style.css' %}">
    <script src="{% static 'js/scripts_home.js' %}" defer></script>

{% endblock %}

{% block conteudo %}

    <!-- Header -->
    <div class="banner">
        <div class="content">
            <img src="{{ movie.title_img.url }}" class="movieTitle">
            <h4>
                <span>{{ movie.release_year}}</span>
                {% if movie.getClassification == 12 %}
                <span><i style="background-color: #2486cc;">{{ movie.getClassification }}+</i></span>
                {% elif movie.getClassification == 14 %}
                <span><i style="background-color: #cc7e24;">{{ movie.getClassification }}+</i></span>
                {% elif movie.getClassification == 16 %}
                <span><i style="background-color: #ff0000;">{{ movie.getClassification }}+</i></span>
                {% elif movie.getClassification == 18 %}
                <span><i style="background-color: #000000;">{{ movie.getClassification }}+</i></span>
                {% endif %}
                <span>{{ movie.getDuration }}H</span>
                <span>
                    {% for genre in movie.getCategory %}

                    {{ genre }} /

                    {% endfor %}
                </span>
            </h4>
            <p class="description" onclick="description(this)">
                {{ movie.getDescription }}
            </p>

            <div class="buttons">
                <a href="play/{{ movie.slug }}"><i class="fa fa-play" aria-hidden = "true"></i>Play</a>
                <a href="trailer/{{ movie.slug }}" class="trailer-button"><i class="fa fa-plus" aria-hidden = "true"></i>Trailer</a>
                <form method="POST">
                    {% csrf_token %}
                    {% if favorited %}
                        <a class="favorite-button no_favorite_color favoriteMovie" data-media-id="{{ movie.id }}" data-movie-slug="{{ movie.slug }}"><i class="fa fa-plus" aria-hidden = "true">Remover dos favoritos</i>
                    {% else%}
                        <a class="favorite-button favorite_color" data-media-id="{{ movie.id }}" data-movie-slug="{{ movie.slug }}"><i class="fa fa-plus" aria-hidden = "true">Add aos Favoritos</i>   
                    {% endif%}
                    </a>
                </form>
            </div>
        </div>
        <video width="440px" loop="true" autoplay="true" controls muted controls poster="assets/banner_freeguy.jpg" class="bg">
            <source src="{{ movie.trailer.url }}" type="video/mp4">
            <object>
              <embed src="{% static 'assets/freeguy_trailer.mp4' %}" type="application/x-shockwave-flash" 
              allowfullscreen="false" allowscriptaccess="always">  		
            </object>
            Formato n√£o suportado  
        </video>
        <div class="shadow"></div>
    </div>

    <script>

        function description(span){
            if($(span).is('.description')){
                $(span).removeClass('description')
            }
            else {
                $(span).addClass('description')
            }
        }

        function setTopo(){
            $(window).scrollTop(0);
        }
        $(window).bind('scroll', setTopo);

        $(document).ready(function () {
            $(".favorite-button").click(function (event) {
                event.preventDefault();
                const button = $(this);
                button.toggleClass('favoriteMovie');
                const is_favorited = button.hasClass('favoriteMovie');
                const slug = button.data("movie-slug");
                $.ajax({
                    url: "{% url 'favorite_movie' %}",
                    type: "POST",
                    data: {
                        slug: slug,
                        is_favorited: is_favorited
                    },
                    success: function (response) {
                        if(button.is('.favoriteMovie')){
                            button.removeClass('favorite_color')
                            button.addClass('no_favorite_color');
                            button[0].innerHTML = 'Remover dos Favoritos'
                        } else {
                            button.removeClass('no_favorite_color')
                            button.addClass('favorite_color')
                            button[0].innerHTML = 'Add aos Favoritos'
                        }
                    },
                    error: function (response) {
                        alert("An error occurred");
                    }
                });
            });
        });
    </script>

{% endblock %}